<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="/css/style.css" />
  <title>Sign Up</title>
</head>
<body class="container py-5">
    <h1 class="mb-4">Create your account</h1>

    <% if (typeof error !== 'undefined') { %>
        <div class="alert alert-danger"><%= error %></div>
    <% } %>

    <form method="post" action="/auth/signup" class="row g-3" autocomplete="off" id="signupForm">
        <div class="col-12 col-md-6">
            <label class="form-label">Username</label>
            <input name="username" id="username" class="form-control" required />
        </div>
        
        <div class="col-12 col-md-6">
            <label class="form-label">Password</label>
            <input name="password" id="password" type="password" class="form-control" required minlength="6" />
            <div id="passwordHelp" class="form-text text-muted">Must be at least 6 characters.</div>
        </div>
        
        <div class="col-12 col-md-6">
            <label class="form-label">Confirm Password</label>
            <input name="confirmPass" id="confirmPass" type="password" class="form-control" required minlength="6" />
            <div id="matchFeedback" class="small fw-bold mt-1"></div>
        </div>
        
        <div class="col-12">
            <button id="submitBtn" class="btn btn-primary" disabled>Sign Up</button>
            <a class="btn btn-link" href="/auth/login">Already have an account?</a>
        </div>
    </form>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const passwordInput = document.getElementById('password');
        const confirmInput = document.getElementById('confirmPass');
        const feedbackDiv = document.getElementById('matchFeedback');
        const submitBtn = document.getElementById('submitBtn');
        const helpText = document.getElementById('passwordHelp');

        function validateForm() {
            const pass = passwordInput.value;
            const confirm = confirmInput.value;
            let isValid = false;

            feedbackDiv.classList.remove('text-success', 'text-danger');
            passwordInput.classList.remove('is-valid', 'is-invalid');
            confirmInput.classList.remove('is-valid', 'is-invalid');

            if (pass.length < 6) {
                helpText.classList.add('text-danger');
                helpText.textContent = `Password is too short (${pass.length}/6)`;
                submitBtn.disabled = true;
                return;

            } else {
                helpText.classList.remove('text-danger');
                helpText.classList.add('text-success');
                helpText.textContent = 'Password length is good.';
            }

            if (pass !== confirm) {
                feedbackDiv.textContent = "Passwords do not match yet...";
                feedbackDiv.classList.add('text-danger');
                confirmInput.classList.add('is-invalid');
                isValid = false;
            } 
            
            else if (pass === confirm && pass.length >= 6) {
                feedbackDiv.textContent = "Passwords match!";
                feedbackDiv.classList.add('text-success');
                confirmInput.classList.remove('is-invalid');
                confirmInput.classList.add('is-valid');
                isValid = true;
            }

            if (isValid) {
                submitBtn.disabled = false;
            } else {
                submitBtn.disabled = true;
            }
        }
        passwordInput.addEventListener('input', validateForm);
        confirmInput.addEventListener('input', validateForm);
    });
</script>
</body>
</html>
